<!DOCTYPE html>
<html>
<head>
    <!-- head definitions go here -->
    <script src="./dist/cosmosb.min.js"></script>
    <script src="./plotly-2.12.1.min.js"></script>
</head>
<body>
    <div id="myPlot" style="width:90%;height:400px;"></div>

    <script type="text/javascript">
        async function main() {
            var xValues = [];

            var yIValues = [];
            var yUValues = [];
            var yPValues = [];

            let items = await queryDB("SELECT * from c");
            items.forEach(item => {
                console.log(`${item._ts} - I: ${item.I}, U: ${item.U}`);

                var date = new Date(item._ts * 1000).toLocaleDateString("en-CA");
                var time = new Date(item._ts * 1000).toLocaleTimeString("pl-PL");

                xValues.push(date + " " + time);

                yIValues.push(item.I);
                yUValues.push(item.U);
                yPValues.push(item.I * item.U);

            });

            


            // Define Data
            var data = [
                {
                    x: xValues, y: yIValues, type: "scatter", name: "Current [A]",
                    marker: {
                        color: 'green'
                    }},
                {
                    x: xValues, y: yUValues, type: "scatter", name: "Voltage [V]",
                    marker: {
                        color: 'blue'
                    }
                },
                {
                    x: xValues, y: yPValues, type: "scatter", name: "Power [W]", yaxis: 'y2',
                    marker: {
                        color: 'red'
                    }
                }
            ];

            // Define Layout
            var layout = {
                title: "Measurements",
                yaxis: {
                    fixedrange: true
                },
                yaxis2: {
                    title: 'Power [W]',
                    titlefont: { color: 're' },
                    tickfont: { color: 'red' },
                    overlaying: 'y',
                    side: 'right',
                    fixedrange: true
                }
            };

            // Display using Plotly
            Plotly.newPlot("myPlot", data, layout);
        }

        main().catch((error) => {
            console.error(error);
        });

    </script>

</body>
</html>
